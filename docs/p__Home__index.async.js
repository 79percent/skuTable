"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{46791:function(Ne,z,i){i.r(z),i.d(z,{default:function(){return Ae}});var ne=i(15009),y=i.n(ne),le=i(99289),D=i.n(le),ue=i(13769),ie=i.n(ue),se=i(97857),S=i.n(se),oe=i(19632),b=i.n(oe),de=i(5574),I=i.n(de),ve=i(88245),K=i(97269),O=i(64317),ce=i(17186),fe=i(48508),Q=i(414),R=i(71577),me=i(38925),he=i(71230),$=i(67294),Z=function(w){for(var m="",k="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",N=0;N<w;N++){var F=Math.floor(Math.random()*k.length);m+=k[F]}return m},J=[{label:"\u578B\u53F7",value:0,attrValue:[{label:"iPhone 12",value:10},{label:"iPhone 13",value:11},{label:"iPhone 14",value:12}]},{label:"\u989C\u8272",value:1,attrValue:[{label:"\u9ED1\u8272",value:13},{label:"\u7EA2\u8272",value:14},{label:"\u84DD\u8272",value:15}]},{label:"\u5185\u5B58",value:2,attrValue:[{label:"32G",value:16},{label:"64G",value:17},{label:"128G",value:18}]}],pe=function(){var E=D()(y()().mark(function w(m){var k;return y()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return k=J.find(function(B){return B.value===m}),F.abrupt("return",(k==null?void 0:k.attrValue)||[]);case 2:case"end":return F.stop()}},w)}));return function(m){return E.apply(this,arguments)}}(),U={attrCard:"attrCard___oGtRe",deleteAttr:"deleteAttr___bgk8Q"},ge=i(24969),p=i(85893),ye=["chileren"],Se=[{title:"\u9500\u552E\u4EF7",dataIndex:"oprice",valueType:"digit",fieldProps:{addonAfter:"\u5143",min:0}},{title:"\u6210\u672C\u4EF7",dataIndex:"cprice",valueType:"digit",fieldProps:{addonAfter:"\u5143",min:0}},{title:"\u5E93\u5B58",dataIndex:"stock",valueType:"digit",fieldProps:{min:0}}];function Ae(){var E=Q.Z.useForm(),w=I()(E,1),m=w[0],k=Q.Z.useForm(),N=I()(k,1),F=N[0],B=(0,$.useState)(null),X=I()(B,2),L=X[0],Ve=X[1],Ce=(0,$.useState)([]),Y=I()(Ce,2),P=Y[0],q=Y[1],ke=(0,$.useState)([]),_=I()(ke,2),C=_[0],j=_[1],Le=(0,$.useState)([]),ee=I()(Le,2),G=ee[0],M=ee[1],be=(0,$.useState)({show:!1,msg:""}),re=I()(be,2),ae=re[0],H=re[1],Fe=C.map(function(f){return f==null?void 0:f.id});console.log(C);var Pe=[].concat(b()(G),Se),W=function(u,a){for(var l=u||(m==null?void 0:m.getFieldsValue()),c=a||P,h=c.map(function(o,g){var d="attrName_".concat(o),A="attrValue_".concat(o),V=l[d],T=l[A]||[];return T=T.map(function(x){return S()(S()({},x.value),{},{chileren:[]})}),{attrName:V,attrValue:T}}),v=h.map(function(o,g){var d=o.attrValue;return d}),e=v.length-1,n=function(){var g=v[e],d=v[e-1];d.forEach(function(A){A.chileren=g}),e--};e>=1;)n();var r=v[0]||[],t=[];function s(o,g){var d=o.chileren,A=ie()(o,ye);g.push(A),Array.isArray(d)&&d.length>0?d.forEach(function(V){s(V,b()(g))}):t.push(g)}return r.forEach(function(o){s(o,[])}),console.log("skuData",t),t},Ie=function(){var f=D()(y()().mark(function u(){var a,l,c;return y()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,m.validateFields();case 2:a="new_".concat(Z(20)),l=P.length,q([].concat(b()(P),[a])),M([].concat(b()(G),[{title:"#",dataIndex:"#".concat(l),editable:!1,render:function(n,r){var t,s=r.skuList;return Array.isArray(s)&&((t=s[l])===null||t===void 0?void 0:t.label)||"-"}}])),C.length===0&&(c=Z(20),j([{id:c,oprice:void 0,cprice:void 0,stock:void 0,skuList:[]}]));case 7:case"end":return v.stop()}},u)}));return function(){return f.apply(this,arguments)}}(),je=function(u,a){var l=b()(G);l[a].title=u.label,l[a].dataIndex=u.value,M(l)},De=function(u){var a=b()(G);a.splice(u,1),a=a.map(function(r,t){return S()(S()({},r),{},{dataIndex:"#".concat(t),render:function(o,g){var d,A=g.skuList;return Array.isArray(A)&&((d=A[t])===null||d===void 0?void 0:d.label)||"-"}})}),M(a);var l=b()(P);if(l.splice(u,1),q(l),l.length===0)j([]);else{var c="attrName_".concat(P[u]),h="attrValue_".concat(P[u]),v=m==null?void 0:m.getFieldsValue();delete v[c],delete v[h];var e=W(v,l),n=b()(C);n.map(function(r){var t=(r==null?void 0:r.skuList)||[];return t=t.splice(u,1),S()(S()({},r),{},{skuList:t})}),n=e.map(function(r){return n.find(function(t){var s=(t==null?void 0:t.skuList)||[];return s.length===r.length&&r.every(function(o,g){var d;return(o==null?void 0:o.value)===((d=s[g])===null||d===void 0?void 0:d.value)})})}),j(n)}},we=function(u,a){var l=W(),c=-1;j(l.map(function(h,v){var e=h.filter(function(r){return r.value!==u.value}),n=C.find(function(r,t){var s=r.skuList||[];if(s.length===0)return!0;var o=e.length===s.length&&e.every(function(d,A){var V;return(d==null?void 0:d.value)===((V=s[A])===null||V===void 0?void 0:V.value)}),g=c;return c=t,t>g&&o});return S()(S()({id:Z(20),oprice:void 0,cprice:void 0,stock:void 0},n),{},{skuList:h})}))},te=function(u,a){var l=W(),c=[];if(l.length===0)c=C.map(function(e){return S()(S()({},e),{},{skuList:[]})});else{var h=-1;c=l.map(function(e,n){var r=C.find(function(t,s){var o=t.skuList||[];if(o.length===0){var g=h;return h=s,s>g}else{var d=e.length===o.length&&e.every(function(V,T){var x;return(V==null?void 0:V.value)===((x=o[T])===null||x===void 0?void 0:x.value)}),A=h;return h=s,s>A&&d}});return S()(S()({},r),{},{skuList:e})})}if(c.length===0){var v=Z(20);j([{id:v,oprice:void 0,cprice:void 0,stock:void 0}])}else j(c)},$e=function(){var f=D()(y()().mark(function u(){var a,l,c,h;return y()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(r){return typeof r=="undefined"||r===""},e.next=3,m.validateFields();case 3:if(C.length!==0){e.next=7;break}return a="\u8BF7\u81F3\u5C11\u6DFB\u52A0\u4E00\u4E2A\u89C4\u683C",H({show:!0,msg:a}),e.abrupt("return",Promise.reject(a));case 7:if(c=C.some(function(n){var r=n.oprice,t=n.cprice,s=n.stock,o=n.skuList;return!Array.isArray(o)||o.length===0||o.length!==P.length||l(r)||l(t)||l(s)}),!c){e.next=12;break}return h="\u8BF7\u6DFB\u52A0\u89C4\u683C\u503C\u3001\u9500\u552E\u4EF7\u3001\u6210\u672C\u4EF7\u3001\u5E93\u5B58",H({show:!0,msg:h}),e.abrupt("return",Promise.reject(h));case 12:return H({show:!1,msg:""}),e.abrupt("return",Promise.resolve(!0));case 14:case"end":return e.stop()}},u)}));return function(){return f.apply(this,arguments)}}();return(0,p.jsxs)(ve.Z,{children:[(0,p.jsxs)(K.A,{form:m,layout:"horizontal",onValuesChange:function(u,a){Ve(a)},labelCol:{span:4},wrapperCol:{span:16},submitter:!1,children:[P.map(function(f,u){var a,l,c,h="attrName_".concat(f),v="attrValue_".concat(f);return(0,p.jsxs)("div",{className:U.attrCard,children:[(0,p.jsx)(O.Z,{label:"\u89C4\u683C\u540D",name:h,allowClear:!1,fieldProps:{labelInValue:!0,onSelect:function(n){return je(n,u)},onChange:function(){var n=m.getFieldsValue();m==null||m.resetFields([v])}},initialValue:void 0,request:D()(y()().mark(function e(){return y()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",J.map(function(t){return{label:t.label,value:t.value}}));case 1:case"end":return r.stop()}},e)})),style:{width:200},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u89C4\u683C\u540D"}]}),(0,p.jsx)(K.A.Item,{isListField:!0,label:"\u89C4\u683C\u503C",wrapperCol:{span:16},children:(0,p.jsx)(ce.u,{name:v,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0",icon:!1,type:"link",disabled:!(L!=null&&(a=L[v])!==null&&a!==void 0&&a.every(function(e){return e==null?void 0:e.value})),style:{width:"unset"}},min:1,initialValue:[{value:void 0}],onAfterRemove:te,copyIconProps:!1,deleteIconProps:(L==null||(l=L[v])===null||l===void 0?void 0:l.length)>1&&{tooltipText:"\u5220\u9664"},itemRender:function(n){var r=n.listDom,t=n.action;return(0,p.jsxs)("div",{style:{display:"inline-flex",marginInlineEnd:25},children:[r,t]})},children:(0,p.jsx)(O.Z,{name:["value"],fieldProps:{allowClear:!1,labelInValue:!0,onSelect:function(n){return we(n,u)},onDeselect:function(n){return te(n,u)}},params:{attrNameValue:L==null||(c=L[h])===null||c===void 0?void 0:c.value},request:function(){var e=D()(y()().mark(function n(r){return y()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",pe(r==null?void 0:r.attrNameValue));case 1:case"end":return s.stop()}},n)}));return function(n){return e.apply(this,arguments)}}(),style:{width:200},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u89C4\u683C\u503C"}]})})}),(0,p.jsx)(R.ZP,{type:"primary",danger:!0,className:U.deleteAttr,onClick:function(){return De(u)},children:"\u5220\u9664\u89C4\u683C\u9879"})]},f)}),(0,p.jsx)(K.A.Item,{label:"",wrapperCol:{span:24},children:(0,p.jsx)(R.ZP,{type:"dashed",icon:(0,p.jsx)(ge.Z,{}),style:{width:"100%"},onClick:Ie,children:"\u6DFB\u52A0\u89C4\u683C\u9879"})})]}),(0,p.jsx)(fe.Z,{rowKey:"id",dataSource:C,columns:Pe,search:!1,options:!1,pagination:!1,editable:{type:"multiple",editableKeys:Fe,form:F,onValuesChange:function(u,a){j(a)}}}),ae.show&&(0,p.jsx)(me.Z,{message:ae.msg,type:"error",showIcon:!0}),(0,p.jsx)(he.Z,{style:{marginTop:16,width:"100%"},justify:"center",align:"middle",children:(0,p.jsx)(R.ZP,{type:"primary",style:{width:120},onClick:D()(y()().mark(function f(){return y()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,$e();case 2:case"end":return a.stop()}},f)})),children:"\u63D0\u4EA4"})})]})}}}]);
